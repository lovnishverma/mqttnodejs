<!DOCTYPE html>
<html>
<head>
  <title>Relay Control</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>MQTT Led's Control</h1>
  <h2>
    <div id="appStatus">App Status: off</div>
  </h2>
  <label class="switch">
    <input id="toggleSwitch" type="checkbox">
    <span class="slider"></span>
    <span class="icon">
      <img class="bulb on" src="https://cdn.glitch.global/08e63b66-17e6-4a37-b447-cb3acf6954ba/pngwing.com.png?v=1691694006535" alt="Bulb On">
      <img class="bulb off" src="https://cdn.glitch.global/08e63b66-17e6-4a37-b447-cb3acf6954ba/pngwing.com%20(1).png?v=1691694065174" alt="Bulb Off">
    </span>
  </label>
  <script>
    $(document).ready(function () {
      $('#toggleSwitch').change(function () {
        const isChecked = $(this).is(':checked');
        const command = isChecked ? '1' : '0';
        $.post('/send-command', { command }, function (data) {
          console.log(data);
        });
      });
    });
  </script>
  <script>
  function updateAppStatus() {
    $.get('/app-status', function (data) {
      $('#appStatus').text('App Status: ' + data);

      // Update the toggle switch based on app status
      if (data === 'on') {
        $('#toggleSwitch').prop('checked', true);
      } else {
        $('#toggleSwitch').prop('checked', false);
      }
    });
  }

  $(document).ready(function () {
    updateAppStatus(); // Initial update

    $('#toggleSwitch').change(function () {
      const isChecked = $(this).is(':checked');
      const command = isChecked ? '1' : '0';
      $.post('/send-command', { command }, function (data) {
        console.log(data);
        updateAppStatus(); // Update app status and toggle switch after sending command
      });
    });
  });
</script>

</body>
</html>
